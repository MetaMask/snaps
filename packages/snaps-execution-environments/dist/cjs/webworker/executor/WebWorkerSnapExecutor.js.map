{"version":3,"sources":["../../../../src/webworker/executor/WebWorkerSnapExecutor.ts"],"sourcesContent":["import ObjectMultiplex from '@metamask/object-multiplex';\nimport type { BasePostMessageStream } from '@metamask/post-message-stream';\nimport { WebWorkerPostMessageStream } from '@metamask/post-message-stream';\nimport { logError, SNAP_STREAM_NAMES } from '@metamask/snaps-utils';\nimport { pipeline } from 'stream';\n\nimport { BaseSnapExecutor } from '../../common/BaseSnapExecutor';\nimport { log } from '../../logging';\n\nexport class WebWorkerSnapExecutor extends BaseSnapExecutor {\n  /**\n   * Initialize the WebWorkerSnapExecutor. This creates a post message stream\n   * from and to the parent window, for two-way communication with the iframe.\n   *\n   * @param stream - The stream to use for communication.\n   * @returns An instance of `WebWorkerSnapExecutor`, with the initialized post\n   * message streams.\n   */\n  static initialize(\n    stream: BasePostMessageStream = new WebWorkerPostMessageStream(),\n  ) {\n    log('Worker: Connecting to parent.');\n\n    const mux = new ObjectMultiplex();\n    pipeline(stream, mux, stream, (error) => {\n      if (error) {\n        logError(`Parent stream failure, closing worker.`, error);\n      }\n      self.close();\n    });\n\n    const commandStream = mux.createStream(SNAP_STREAM_NAMES.COMMAND);\n    const rpcStream = mux.createStream(SNAP_STREAM_NAMES.JSON_RPC);\n\n    return new WebWorkerSnapExecutor(commandStream, rpcStream);\n  }\n}\n"],"names":["WebWorkerSnapExecutor","BaseSnapExecutor","initialize","stream","WebWorkerPostMessageStream","log","mux","ObjectMultiplex","pipeline","error","logError","self","close","commandStream","createStream","SNAP_STREAM_NAMES","COMMAND","rpcStream","JSON_RPC"],"mappings":";;;;+BASaA;;;eAAAA;;;wEATe;mCAEe;4BACC;wBACnB;kCAEQ;yBACb;;;;;;AAEb,MAAMA,8BAA8BC,kCAAgB;IACzD;;;;;;;GAOC,GACD,OAAOC,WACLC,SAAgC,IAAIC,6CAA0B,EAAE,EAChE;QACAC,IAAAA,YAAG,EAAC;QAEJ,MAAMC,MAAM,IAAIC,wBAAe;QAC/BC,IAAAA,gBAAQ,EAACL,QAAQG,KAAKH,QAAQ,CAACM;YAC7B,IAAIA,OAAO;gBACTC,IAAAA,oBAAQ,EAAC,CAAC,sCAAsC,CAAC,EAAED;YACrD;YACAE,KAAKC,KAAK;QACZ;QAEA,MAAMC,gBAAgBP,IAAIQ,YAAY,CAACC,6BAAiB,CAACC,OAAO;QAChE,MAAMC,YAAYX,IAAIQ,YAAY,CAACC,6BAAiB,CAACG,QAAQ;QAE7D,OAAO,IAAIlB,sBAAsBa,eAAeI;IAClD;AACF"}