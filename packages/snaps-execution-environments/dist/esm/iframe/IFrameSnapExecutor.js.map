{"version":3,"sources":["../../../src/iframe/IFrameSnapExecutor.ts"],"sourcesContent":["import ObjectMultiplex from '@metamask/object-multiplex';\nimport type { BasePostMessageStream } from '@metamask/post-message-stream';\nimport { WindowPostMessageStream } from '@metamask/post-message-stream';\nimport { logError, SNAP_STREAM_NAMES } from '@metamask/snaps-utils';\nimport { pipeline } from 'stream';\n\nimport { BaseSnapExecutor } from '../common/BaseSnapExecutor';\nimport { log } from '../logging';\n\nexport class IFrameSnapExecutor extends BaseSnapExecutor {\n  /**\n   * Initialize the IFrameSnapExecutor. This creates a post message stream from\n   * and to the parent window, for two-way communication with the iframe.\n   *\n   * @param stream - The stream to use for communication.\n   * @returns An instance of `IFrameSnapExecutor`, with the initialized post\n   * message streams.\n   */\n  static initialize(\n    stream: BasePostMessageStream = new WindowPostMessageStream({\n      name: 'child',\n      target: 'parent',\n      targetWindow: self.parent,\n      targetOrigin: '*',\n    }),\n  ) {\n    log('Worker: Connecting to parent.');\n\n    const mux = new ObjectMultiplex();\n    pipeline(stream, mux, stream, (error) => {\n      if (error) {\n        logError(`Parent stream failure, closing worker.`, error);\n      }\n      self.close();\n    });\n\n    const commandStream = mux.createStream(SNAP_STREAM_NAMES.COMMAND);\n    const rpcStream = mux.createStream(SNAP_STREAM_NAMES.JSON_RPC);\n\n    return new IFrameSnapExecutor(commandStream, rpcStream);\n  }\n}\n"],"names":["ObjectMultiplex","WindowPostMessageStream","logError","SNAP_STREAM_NAMES","pipeline","BaseSnapExecutor","log","IFrameSnapExecutor","initialize","stream","name","target","targetWindow","self","parent","targetOrigin","mux","error","close","commandStream","createStream","COMMAND","rpcStream","JSON_RPC"],"mappings":"AAAA,OAAOA,qBAAqB,6BAA6B;AAEzD,SAASC,uBAAuB,QAAQ,gCAAgC;AACxE,SAASC,QAAQ,EAAEC,iBAAiB,QAAQ,wBAAwB;AACpE,SAASC,QAAQ,QAAQ,SAAS;AAElC,SAASC,gBAAgB,QAAQ,6BAA6B;AAC9D,SAASC,GAAG,QAAQ,aAAa;AAEjC,OAAO,MAAMC,2BAA2BF;IACtC;;;;;;;GAOC,GACD,OAAOG,WACLC,SAAgC,IAAIR,wBAAwB;QAC1DS,MAAM;QACNC,QAAQ;QACRC,cAAcC,KAAKC,MAAM;QACzBC,cAAc;IAChB,EAAE,EACF;QACAT,IAAI;QAEJ,MAAMU,MAAM,IAAIhB;QAChBI,SAASK,QAAQO,KAAKP,QAAQ,CAACQ;YAC7B,IAAIA,OAAO;gBACTf,SAAS,CAAC,sCAAsC,CAAC,EAAEe;YACrD;YACAJ,KAAKK,KAAK;QACZ;QAEA,MAAMC,gBAAgBH,IAAII,YAAY,CAACjB,kBAAkBkB,OAAO;QAChE,MAAMC,YAAYN,IAAII,YAAY,CAACjB,kBAAkBoB,QAAQ;QAE7D,OAAO,IAAIhB,mBAAmBY,eAAeG;IAC/C;AACF"}